name = "chinese-learning-mcp"
main = "src/index.ts"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat"]

# D1 Database (same as main API)
[[d1_databases]]
binding = "DB"
database_name = "chinese-learning-db"
database_id = "b1ccbb96-0328-4c36-95d8-d7fe18171d82"

# KV Namespace for OAuth state storage
# Create with: wrangler kv:namespace create OAUTH_KV
[[kv_namespaces]]
binding = "OAUTH_KV"
id = "7477802c478b4d67ac8586f32bc42936"

# Durable Object for MCP Agent state (SQLite-backed required by McpAgent)
[durable_objects]
bindings = [
  { name = "MCP_OBJECT", class_name = "ChineseLearningMCPv2" }
]

# v1 migration created non-SQLite class, v2 creates SQLite-backed class
[[migrations]]
tag = "v1"
new_classes = ["ChineseLearningMCP"]

[[migrations]]
tag = "v2"
new_sqlite_classes = ["ChineseLearningMCPv2"]

[vars]
ENVIRONMENT = "production"

# Secrets (set via wrangler secret put):
# - GOOGLE_CLIENT_ID
# - GOOGLE_CLIENT_SECRET
# - COOKIE_ENCRYPTION_KEY (generate with: openssl rand -hex 32)

[dev]
port = 8788
